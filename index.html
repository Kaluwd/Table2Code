<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Table2Code - Smart Table Converter</title>
    <meta name="description" content="Convert Excel/CSV data to SQL, TypeScript, JSON and more with one click. Perfect for developers!">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&family=Fira+Code&display=swap" rel="stylesheet">
    <script defer data-domain="table2-code-8hmy.vercel.app" src="https://plausible.io/js/script.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf-lib/1.17.1/pdf-lib.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mammoth/1.4.0/mammoth.browser.min.js"></script>
    <style>
        :root {
            --primary: #3b82f6;
            --primary-dark: #2563eb;
            --dark: #1e293b;
            --light: #f8fafc;
            --dark-bg: #0f172a;
            --dark-container: #1e293b;
            --dark-output: #334155;
            --border-color: #e2e8f0;
            --border-dark: #475569;
        }
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        body {
            font-family: 'Inter', system-ui, -apple-system, sans-serif;
            line-height: 1.6;
            background-color: #f1f5f9;
            color: var(--dark);
            margin: 0;
            padding: 15px;
            transition: all 0.3s ease;
            min-height: 100vh;
        }
        .container {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            transition: all 0.3s;
            max-width: 100%;
            overflow: hidden;
            margin: 0 auto;
        }
        h1 {
            color: var(--primary);
            font-size: clamp(1.5rem, 5vw, 2rem);
            margin-top: 0;
            margin-bottom: 10px;
        }
        #input-container {
            position: relative;
            margin-bottom: 15px;
        }
        #input-area {
            min-height: 120px;
            border: 2px dashed var(--border-color);
            padding: 12px;
            outline: none;
            background: white;
            color: var(--dark);
            transition: all 0.3s;
            width: 100%;
            font-family: inherit;
            white-space: pre;
            border-radius: 6px;
            line-height: 1.5;
        }
        #input-area.drag-over {
            background-color: #ebf4ff;
            border-color: var(--primary);
        }
        .dark-mode #input-area.drag-over {
            background-color: #1e3a8a;
        }
        #placeholder {
            position: absolute;
            top: 12px;
            left: 12px;
            right: 12px;
            color: #64748b;
            pointer-events: none;
            background: white;
            padding: 4px;
            line-height: 1.5;
        }
        #placeholder div:first-child {
            margin-bottom: 8px;
        }
        .placeholder-example {
            font-family: 'Fira Code', monospace, Menlo, Consolas;
            color: #94a3b8;
            font-size: 0.9em;
        }
        #output-area {
            background: #f8fafc;
            border: 1px solid var(--border-color);
            padding: 12px;
            border-radius: 5px;
            white-space: pre-wrap;
            font-family: 'Fira Code', monospace, Menlo, Consolas;
            overflow-x: auto;
            color: var(--dark);
            transition: all 0.3s;
            font-size: 14px;
            min-height: 100px;
            max-height: 400px;
            overflow-y: auto;
        }
        .btn-group {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin: 10px 0;
        }
        .btn {
            background: var(--primary);
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 14px;
            flex: 1 0 auto;
            white-space: nowrap;
            text-align: center;
            font-family: 'Inter', sans-serif;
            font-weight: 500;
        }
        .btn:hover {
            background: var(--primary-dark);
        }
        .btn-secondary {
            background: #e2e8f0;
            color: var(--dark);
        }
        .btn-secondary:hover {
            background: #cbd5e1;
        }
        .btn-warning {
            background: #f59e0b;
        }
        .btn-warning:hover {
            background: #d97706;
        }
        .btn-danger {
            background: #ef4444;
        }
        .btn-danger:hover {
            background: #dc2626;
        }
        .btn-success {
            background: #10b981;
        }
        .btn-success:hover {
            background: #059669;
        }
        .btn-sm {
            padding: 6px 10px;
            font-size: 13px;
        }
        .dark-mode {
            background-color: var(--dark-bg);
            color: var(--light);
        }
        .dark-mode .container {
            background: var(--dark-container);
            color: white;
        }
        .dark-mode #input-area {
            background: var(--dark-container);
            color: white;
            border-color: var(--border-dark);
        }
        .dark-mode #placeholder {
            background: var(--dark-container);
        }
        .dark-mode #output-area {
            background: var(--dark-output);
            color: #e2e8f0;
            border-color: var(--border-dark);
        }
        .section-title {
            font-weight: 600;
            margin: 15px 0 8px 0;
            font-size: 16px;
        }
        .issues-panel {
            margin: 15px 0;
            padding: 12px;
            background: #fee2e2;
            border-radius: 5px;
            color: #b91c1c;
        }
        .dark-mode .issues-panel {
            background: #7f1d1d;
            color: #fecaca;
        }
        .issue-item {
            margin: 8px 0;
            padding: 8px;
            display: flex;
            flex-direction: column;
            gap: 8px;
            background: rgba(255,255,255,0.7);
            border-radius: 4px;
        }
        .dark-mode .issue-item {
            background: rgba(0,0,0,0.2);
        }
        .issue-actions {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
        }
        #editable-table {
            display: none;
            margin-top: 15px;
            overflow-x: auto;
            background: white;
            border-radius: 6px;
            padding: 10px;
            border: 1px solid var(--border-color);
        }
        .dark-mode #editable-table {
            background: var(--dark-container);
            border-color: var(--border-dark);
        }
        #data-table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 10px;
            font-size: 14px;
        }
        #data-table th, #data-table td {
            border: 1px solid var(--border-color);
            padding: 8px;
            text-align: left;
            position: relative;
        }
        .dark-mode #data-table th,
        .dark-mode #data-table td {
            border-color: var(--border-dark);
        }
        #data-table th {
            background-color: #f1f5f9;
            position: sticky;
            top: 0;
            font-weight: 600;
        }
        .dark-mode #data-table th {
            background-color: #334155;
        }
        .cell-edit {
            width: 100%;
            border: none;
            padding: 4px;
            font-family: inherit;
            background: transparent;
            color: inherit;
        }
        .cell-edit:focus {
            outline: 2px solid var(--primary);
            border-radius: 3px;
        }
        .footer {
            margin-top: 30px;
            padding-top: 15px;
            border-top: 1px solid var(--border-color);
            text-align: center;
            font-size: 13px;
            color: #64748b;
        }
        .dark-mode .footer {
            border-color: var(--border-dark);
            color: #94a3b8;
        }
        .footer a {
            color: var(--primary);
            text-decoration: none;
        }
        .footer a:hover {
            text-decoration: underline;
        }
        .footer-links {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 12px;
            margin: 8px 0;
        }
        #info-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            padding: 15px;
        }
        .modal-content {
            background: white;
            padding: 20px;
            border-radius: 8px;
            max-width: 500px;
            max-height: 80vh;
            overflow: auto;
            width: 100%;
        }
        .dark-mode .modal-content {
            background: var(--dark-container);
        }
        /* Chart Modal Styles */
        .modal {
            display: none;
            position: fixed;
            z-index: 1001;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.7);
        }
        .modal-content {
            background-color: #fff;
            margin: 5% auto;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        .dark-mode .modal-content {
            background-color: var(--dark-container);
            color: white;
        }
        .close {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }
        .close:hover {
            color: black;
        }
        .dark-mode .close:hover {
            color: white;
        }
        .chart-controls {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 20px;
            align-items: center;
        }
        .chart-select {
            padding: 8px;
            border-radius: 4px;
            border: 1px solid var(--border-color);
            background: white;
            color: var(--dark);
        }
        .dark-mode .chart-select {
            background: var(--dark-output);
            color: white;
            border-color: var(--border-dark);
        }
        .chart-container {
            width: 100%;
            height: 70vh;
            position: relative;
        }
        /* File upload styles */
        .file-upload-container {
            margin-bottom: 15px;
        }
        .file-upload-btn {
            display: inline-block;
            padding: 8px 16px;
            background: var(--primary);
            color: white;
            border-radius: 4px;
            cursor: pointer;
            transition: background 0.2s;
        }
        .file-upload-btn:hover {
            background: var(--primary-dark);
        }
        #file-input {
            display: none;
        }
        .file-info {
            margin-top: 8px;
            font-size: 14px;
            color: #64748b;
        }
        .dark-mode .file-info {
            color: #94a3b8;
        }
        .conversion-history {
            margin-top: 15px;
            border-top: 1px solid var(--border-color);
            padding-top: 15px;
        }
        .dark-mode .conversion-history {
            border-color: var(--border-dark);
        }
        .history-item {
            padding: 8px;
            margin-bottom: 8px;
            background: #f1f5f9;
            border-radius: 4px;
            cursor: pointer;
            transition: background 0.2s;
        }
        .history-item:hover {
            background: #e2e8f0;
        }
        .dark-mode .history-item {
            background: #334155;
            color: white;
        }
        .dark-mode .history-item:hover {
            background: #475569;
        }
        .history-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 4px;
        }
        .history-type {
            font-weight: 600;
        }
        .history-date {
            font-size: 12px;
            color: #64748b;
        }
        .dark-mode .history-date {
            color: #94a3b8;
        }
        @media (max-width: 600px) {
            .btn {
                padding: 8px;
                font-size: 13px;
                min-width: calc(50% - 4px);
            }
            #input-area {
                min-height: 100px;
                padding: 10px;
                font-size: 14px;
            }
            #output-area {
                padding: 10px;
                font-size: 13px;
            }
            .container {
                padding: 15px;
            }
            .btn-group {
                gap: 6px;
            }
            .modal-content {
                width: 95%;
                margin: 10% auto;
            }
            .chart-controls {
                flex-direction: column;
                align-items: stretch;
            }
            .chart-container {
                height: 50vh;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Table2Code</h1>
        <p>Upload or paste any table (Excel, CSV, Word, PDF) and convert to developer formats:</p>
        
        <div class="file-upload-container">
            <label for="file-input" class="file-upload-btn">üìÅ Upload File (CSV, Excel, Word, PDF)</label>
            <input type="file" id="file-input" accept=".csv,.xlsx,.xls,.docx,.pdf">
            <div class="file-info" id="file-info">No file selected</div>
        </div>
        
        <div id="input-container">
            <div 
                id="input-area" 
                contenteditable="true"
                aria-label="Paste table data here or drag & drop file"
            ></div>
            <div id="placeholder">
                <div>Paste your table here (e.g. from Excel) or drag & drop file...</div>
                <div class="placeholder-example">
                    <div>id  name    email           join_date</div>
                    <div>1   miki    miki@dev.com    2023-01-15</div>
                    <div>2   yishak  yishak@dev.com  2023-02-20</div>
                </div>
            </div>
        </div>
        
        <div class="section-title">Convert To:</div>
        <div class="btn-group">
            <button class="btn" onclick="convertTo('sql')">SQL</button>
            <button class="btn" onclick="convertTo('smart-sql')">Smart SQL</button>
            <button class="btn" onclick="convertTo('typescript')">TypeScript</button>
            <button class="btn" onclick="convertTo('json')">JSON</button>
            <button class="btn" onclick="convertTo('mock-api')">Mock API</button>
            <button class="btn" onclick="convertTo('markdown')">Markdown</button>
            <button class="btn" onclick="downloadCSV()">Download CSV</button>
            <button class="btn" onclick="convertTo('chart')">üìä Generate Chart</button>
        </div>
        
        <div class="section-title">Data Tools:</div>
        <div class="btn-group">
            <button class="btn btn-warning" onclick="analyzeData()">üîç Find Issues</button>
            <button class="btn btn-secondary" onclick="cleanData()">üõ† Fix Common</button>
            <button class="btn btn-success" onclick="copyToClipboard()">üìã Copy</button>
            <button class="btn" onclick="generateShareLink()">üîó Share</button>
            <button class="btn" onclick="toggleDarkMode()">üåô Dark Mode</button>
        </div>
        
        <div id="issues-area" class="issues-panel" style="display:none;">
            <h3 style="margin-top:0;">‚ö†Ô∏è Data Issues Found:</h3>
            <div id="issues-list"></div>
            <div class="btn-group" style="margin-top:10px;">
                <button class="btn btn-sm" onclick="showEditableTable()">Edit Full Table</button>
                <button class="btn btn-sm btn-danger" onclick="hideIssuesPanel()">Close</button>
            </div>
        </div>
        
        <div class="section-title">Output:</div>
        <div id="output-area">Your converted code will appear here...</div>
        
        <div id="editable-table">
            <div class="btn-group">
                <button class="btn btn-success btn-sm" onclick="saveTableEdits()">üíæ Save</button>
                <button class="btn btn-danger btn-sm" onclick="hideEditableTable()">‚ùå Cancel</button>
                <button class="btn btn-sm" onclick="addNewRow()">‚ûï Add Row</button>
                <button class="btn btn-sm" onclick="addNewColumn()">‚ûï Add Column</button>
                <button class="btn btn-sm btn-warning" onclick="deleteSelectedRows()">üóë Delete Selected</button>
            </div>
            <table id="data-table"></table>
        </div>
        
        <div class="conversion-history" id="conversion-history" style="display: none;">
            <h3>Conversion History</h3>
            <div id="history-items"></div>
        </div>
    </div>
    
    <!-- Chart Modal -->
    <div id="chart-modal" class="modal">
        <div class="modal-content" style="max-width: 800px;">
            <span class="close" onclick="closeChartModal()">&times;</span>
            <h2>Chart Visualization</h2>
            <div class="chart-controls">
                <select id="chart-type" class="chart-select">
                    <option value="bar">Bar Chart</option>
                    <option value="line">Line Chart</option>
                    <option value="pie">Pie Chart</option>
                    <option value="doughnut">Doughnut Chart</option>
                    <option value="radar">Radar Chart</option>
                </select>
                <select id="x-axis" class="chart-select"></select>
                <select id="y-axis" class="chart-select"></select>
                <button onclick="updateChart()" class="btn">Update Chart</button>
                <button onclick="downloadChart()" class="btn btn-success">Download PNG</button>
                <button onclick="downloadChartSVG()" class="btn btn-success">Download SVG</button>
            </div>
            <div class="chart-container">
                <canvas id="data-chart"></canvas>
            </div>
        </div>
    </div>
    
    <div class="footer">
        <div>Table2Code v1.3.0</div>
        <div>Developed by <a href="https://aps-kappa.vercel.app/" id="developer-link">Kws</a></div>
        <div class="footer-links">
            <a href="#" onclick="showAbout()">About</a>
            <a href="#" onclick="showPrivacy()">Privacy</a>
        </div>
        <div>¬© 2025 All rights reserved</div>
    </div>

    <div id="info-modal">
        <div class="modal-content">
            <h3 style="margin-top:0;" id="modal-title">About</h3>
            <div id="modal-content"></div>
            <button class="btn" onclick="document.getElementById('info-modal').style.display='none'" style="margin-top:15px;">Close</button>
        </div>
    </div>
    <script>
        // Global variables
        let currentData = [];
        let currentHeaders = [];
        let conversionHistory = [];
        let currentChart = null;
        
        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            // Load dark mode preference
            if (localStorage.getItem('darkMode') === 'true') {
                document.body.classList.add('dark-mode');
            }
            
            // Set up event listeners
            setupEventListeners();
            
            // Load any saved data from localStorage
            loadSavedData();
        });
        
        function setupEventListeners() {
            const inputArea = document.getElementById('input-area');
            const fileInput = document.getElementById('file-input');
            
            // Handle paste event
            inputArea.addEventListener('paste', handlePaste);
            
            // Handle input changes
            inputArea.addEventListener('input', function() {
                document.getElementById('placeholder').style.display = this.textContent.trim() ? 'none' : 'block';
            });
            
            // Handle file input change
            fileInput.addEventListener('change', handleFileUpload);
            
            // Set up drag and drop
            inputArea.addEventListener('dragover', function(e) {
                e.preventDefault();
                this.classList.add('drag-over');
            });
            
            inputArea.addEventListener('dragleave', function() {
                this.classList.remove('drag-over');
            });
            
            inputArea.addEventListener('drop', function(e) {
                e.preventDefault();
                this.classList.remove('drag-over');
                
                if (e.dataTransfer.files.length) {
                    handleFileUpload({ target: { files: e.dataTransfer.files } });
                }
            });
        }
        
        function handlePaste(e) {
            // Handle CSV/TSV data
            const clipboardData = e.clipboardData || window.clipboardData;
            const pastedData = clipboardData.getData('text');
            
            // Check if the pasted data looks like a table
            if (pastedData.includes('\t') || pastedData.includes(',') || pastedData.match(/\s{2,}/)) {
                setTimeout(() => {
                    parseInputData();
                }, 10);
            }
        }
        
        function handleFileUpload(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            document.getElementById('file-info').textContent = `Selected: ${file.name}`;
            
            const reader = new FileReader();
            
            reader.onload = function(e) {
                const data = e.target.result;
                
                // Handle different file types
                if (file.name.endsWith('.csv')) {
                    parseCSV(data);
                } else if (file.name.endsWith('.xlsx') || file.name.endsWith('.xls')) {
                    parseExcel(data);
                } else if (file.name.endsWith('.docx')) {
                    parseWordDoc(data);
                } else if (file.name.endsWith('.pdf')) {
                    parsePDF(data);
                } else {
                    alert('Unsupported file type. Please upload CSV, Excel, Word, or PDF.');
                }
            };
            
            if (file.name.endsWith('.pdf') || file.name.endsWith('.docx')) {
                reader.readAsArrayBuffer(file);
            } else {
                reader.readAsText(file);
            }
        }
        
        async function parsePDF(data) {
            try {
                // PDF parsing is complex and would typically require a server-side component
                // This is a simplified example that would need enhancement
                alert('PDF parsing is limited in browser. For best results, extract tables manually and paste.');
                
                // For demonstration, we'll just show the user to paste the content
                document.getElementById('input-area').textContent = 'Please paste your PDF table content here...';
                document.getElementById('placeholder').style.display = 'none';
                
            } catch (error) {
                console.error('Error parsing PDF:', error);
                alert('Error parsing PDF. Please try pasting the table content manually.');
            }
        }
        
        async function parseWordDoc(data) {
            try {
                const result = await mammoth.extractRawText({ arrayBuffer: data });
                const text = result.value;
                
                // Try to detect tables in the Word doc (simplified approach)
                const lines = text.split('\n').filter(line => line.trim());
                
                // Display the content for manual adjustment
                document.getElementById('input-area').textContent = lines.join('\n');
                document.getElementById('placeholder').style.display = 'none';
                
                // Parse the data
                setTimeout(() => {
                    parseInputData();
                }, 100);
                
            } catch (error) {
                console.error('Error parsing Word document:', error);
                alert('Error parsing Word document. Please try pasting the table content manually.');
            }
        }
        
        function parseExcel(data) {
            try {
                const workbook = XLSX.read(data, { type: 'binary' });
                const firstSheetName = workbook.SheetNames[0];
                const worksheet = workbook.Sheets[firstSheetName];
                
                // Convert to JSON
                const jsonData = XLSX.utils.sheet_to_json(worksheet, { header: 1 });
                
                // Process the data
                processParsedData(jsonData);
                
            } catch (error) {
                console.error('Error parsing Excel file:', error);
                alert('Error parsing Excel file. Please ensure it contains valid table data.');
            }
        }
        
        function parseCSV(data) {
            try {
                // Split into lines
                const lines = data.split(/\r?\n/).filter(line => line.trim());
                
                // Detect delimiter (comma, tab, or semicolon)
                let delimiter = ',';
                if (lines[0].includes('\t')) delimiter = '\t';
                else if (lines[0].includes(';')) delimiter = ';';
                
                // Parse CSV
                const parsedData = lines.map(line => line.split(delimiter));
                
                // Process the data
                processParsedData(parsedData);
                
            } catch (error) {
                console.error('Error parsing CSV:', error);
                alert('Error parsing CSV file. Please ensure it contains valid CSV data.');
            }
        }
        
        function processParsedData(data) {
            if (data.length === 0) return;
            
            // Use first row as headers if it looks like headers
            const firstRow = data[0];
            const secondRow = data[1] || [];
            
            // Check if first row looks like headers (non-empty, most cells don't look like numbers)
            const looksLikeHeaders = firstRow.some(cell => cell && cell.toString().trim()) && 
                                    firstRow.filter(cell => cell && !isNaN(cell)).length < firstRow.length / 2;
            
            if (looksLikeHeaders) {
                currentHeaders = firstRow.map(String);
                currentData = data.slice(1).map(row => {
                    const obj = {};
                    currentHeaders.forEach((header, i) => {
                        obj[header] = row[i] !== undefined ? String(row[i]) : '';
                    });
                    return obj;
                });
            } else {
                // Generate default headers (A, B, C, ...)
                currentHeaders = firstRow.map((_, i) => String.fromCharCode(65 + i));
                currentData = data.map(row => {
                    const obj = {};
                    currentHeaders.forEach((header, i) => {
                        obj[header] = row[i] !== undefined ? String(row[i]) : '';
                    });
                    return obj;
                });
            }
            
            // Display the data in the input area
            displayDataAsText();
            
            // Hide placeholder
            document.getElementById('placeholder').style.display = 'none';
        }
        
        function displayDataAsText() {
            const inputArea = document.getElementById('input-area');
            
            // Create a text representation of the data
            let text = currentHeaders.join('\t') + '\n';
            currentData.forEach(row => {
                text += currentHeaders.map(header => row[header] || '').join('\t') + '\n';
            });
            
            inputArea.textContent = text.trim();
        }
        
        function parseInputData() {
            const inputText = document.getElementById('input-area').textContent.trim();
            if (!inputText) return;
            
            // Split into lines
            const lines = inputText.split(/\r?\n/).filter(line => line.trim());
            
            // Detect delimiter (tab, comma, or multiple spaces)
            let delimiter = '\t';
            if (lines[0].includes(',')) delimiter = ',';
            else if (lines[0].match(/\s{2,}/)) {
                // For fixed-width columns separated by multiple spaces
                delimiter = /\s{2,}/;
            }
            
            // Parse the data
            const parsedData = lines.map(line => {
                if (typeof delimiter === 'string') {
                    return line.split(delimiter).map(cell => cell.trim());
                } else {
                    // Handle multiple spaces delimiter
                    return line.split(delimiter).map(cell => cell.trim());
                }
            });
            
            // Process the parsed data
            processParsedData(parsedData);
        }
        
        function convertTo(format) {
            if (!currentData.length || !currentHeaders.length) {
                alert('Please input some table data first.');
                return;
            }
            
            parseInputData(); // Ensure data is up to date
            
            let output = '';
            const timestamp = new Date().toLocaleString();
            
            switch (format) {
                case 'sql':
                    output = generateSQL();
                    break;
                case 'smart-sql':
                    output = generateSmartSQL();
                    break;
                case 'typescript':
                    output = generateTypeScript();
                    break;
                case 'json':
                    output = generateJSON();
                    break;
                case 'mock-api':
                    output = generateMockAPI();
                    break;
                case 'markdown':
                    output = generateMarkdown();
                    break;
                case 'chart':
                    showChartModal();
                    return;
                default:
                    output = 'Unknown format';
            }
            
            // Display the output
            document.getElementById('output-area').textContent = output;
            
            // Add to history
            addToHistory(format, output, timestamp);
        }
        
        function generateSQL() {
            // Generate a table name based on the first header or use a default
            const tableName = currentHeaders[0] ? currentHeaders[0].toLowerCase().replace(/\s+/g, '_') + '_table' : 'my_table';
            
            let sql = `-- SQL CREATE TABLE and INSERT statements\n`;
            sql += `CREATE TABLE ${tableName} (\n`;
            sql += `  id INT AUTO_INCREMENT PRIMARY KEY,\n`;
            
            // Add columns
            currentHeaders.forEach(header => {
                // Try to guess the column type
                const sampleValue = currentData[0][header];
                let columnType = 'VARCHAR(255)';
                
                if (!isNaN(sampleValue) && sampleValue.toString().trim() !== '') {
                    if (sampleValue.includes('.')) {
                        columnType = 'DECIMAL(10,2)';
                    } else {
                        columnType = 'INT';
                    }
                } else if (sampleValue.match(/^\d{4}-\d{2}-\d{2}$/)) {
                    columnType = 'DATE';
                } else if (sampleValue.match(/^\d{4}-\d{2}-\d{2} \d{2}:\d{2}:\d{2}$/)) {
                    columnType = 'DATETIME';
                }
                
                const columnName = header.toLowerCase().replace(/\s+/g, '_');
                sql += `  ${columnName} ${columnType},\n`;
            });
            
            sql = sql.replace(/,\n$/, '\n'); // Remove last comma
            sql += `);\n\n`;
            
            // Add INSERT statements
            currentData.forEach(row => {
                const columns = currentHeaders.map(h => h.toLowerCase().replace(/\s+/g, '_')).join(', ');
                const values = currentHeaders.map(header => {
                    const value = row[header] || '';
                    return value === '' ? 'NULL' : `'${value.replace(/'/g, "''")}'`;
                }).join(', ');
                
                sql += `INSERT INTO ${tableName} (${columns}) VALUES (${values});\n`;
            });
            
            return sql;
        }
        
        function generateSmartSQL() {
            // Similar to SQL but with smarter type detection and additional constraints
            const tableName = currentHeaders[0] ? currentHeaders[0].toLowerCase().replace(/\s+/g, '_') + '_table' : 'my_table';
            
            let sql = `-- Smart SQL with better type detection\n`;
            sql += `CREATE TABLE ${tableName} (\n`;
            sql += `  id INT AUTO_INCREMENT PRIMARY KEY,\n`;
            
            // Analyze each column for better type detection
            currentHeaders.forEach(header => {
                const columnName = header.toLowerCase().replace(/\s+/g, '_');
                const values = currentData.map(row => row[header]).filter(val => val !== '');
                
                if (values.length === 0) {
                    sql += `  ${columnName} VARCHAR(255) NULL,\n`;
                    return;
                }
                
                // Check for boolean values
                const booleanValues = ['true', 'false', 'yes', 'no', '1', '0'];
                const isBoolean = values.every(val => booleanValues.includes(val.toLowerCase()));
                
                if (isBoolean) {
                    sql += `  ${columnName} TINYINT(1) DEFAULT 0,\n`;
                    return;
                }
                
                // Check for numbers
                const allNumbers = values.every(val => !isNaN(val));
                if (allNumbers) {
                    const hasDecimals = values.some(val => val.includes('.'));
                    if (hasDecimals) {
                        sql += `  ${columnName} DECIMAL(10,2),\n`;
                    } else {
                        // Check if it's probably an ID
                        const isProbablyId = header.toLowerCase().includes('id') && 
                                            values.every(val => parseInt(val) > 0);
                        if (isProbablyId) {
                            sql += `  ${columnName} INT UNSIGNED,\n`;
                        } else {
                            sql += `  ${columnName} INT,\n`;
                        }
                    }
                    return;
                }
                
                // Check for dates
                const datePattern1 = /^\d{4}-\d{2}-\d{2}$/;
                const datePattern2 = /^\d{2}\/\d{2}\/\d{4}$/;
                const isDate = values.every(val => datePattern1.test(val) || datePattern2.test(val));
                
                if (isDate) {
                    sql += `  ${columnName} DATE,\n`;
                    return;
                }
                
                // Check for date-time
                const dateTimePattern = /^\d{4}-\d{2}-\d{2} \d{2}:\d{2}:\d{2}$/;
                const isDateTime = values.every(val => dateTimePattern.test(val));
                
                if (isDateTime) {
                    sql += `  ${columnName} DATETIME,\n`;
                    return;
                }
                
                // Check for email
                const emailPattern = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                const isEmail = values.every(val => emailPattern.test(val));
                
                if (isEmail) {
                    sql += `  ${columnName} VARCHAR(255) CHECK (${columnName} LIKE '%_@__%.__%'),\n`;
                    return;
                }
                
                // Default to string
                const maxLength = Math.max(...values.map(val => val.length));
                const varcharLength = Math.min(Math.max(maxLength, 50), 255);
                sql += `  ${columnName} VARCHAR(${varcharLength}),\n`;
            });
            
            sql = sql.replace(/,\n$/, '\n'); // Remove last comma
            sql += `);\n\n`;
            
            // Add indexes for columns that might need them
            currentHeaders.forEach(header => {
                const columnName = header.toLowerCase().replace(/\s+/g, '_');
                if (columnName.includes('email') || columnName.includes('username')) {
                    sql += `CREATE UNIQUE INDEX idx_${columnName} ON ${tableName}(${columnName});\n`;
                } else if (columnName.includes('name') || columnName.includes('title')) {
                    sql += `CREATE INDEX idx_${columnName} ON ${tableName}(${columnName});\n`;
                }
            });
            
            return sql;
        }
        
        function generateTypeScript() {
            let ts = `// TypeScript interface and sample data\n`;
            ts += `interface ${currentHeaders[0] || 'MyData'} {\n`;
            
            // Generate interface properties
            currentHeaders.forEach(header => {
                const values = currentData.map(row => row[header]).filter(val => val !== '');
                const sampleValue = values[0] || '';
                
                let propType = 'string';
                if (!isNaN(sampleValue) {
                    propType = sampleValue.includes('.') ? 'number' : 'number';
                } else if (sampleValue.match(/^\d{4}-\d{2}-\d{2}$/) || sampleValue.match(/^\d{4}-\d{2}-\d{2} \d{2}:\d{2}:\d{2}$/)) {
                    propType = 'Date | string';
                } else if (sampleValue.toLowerCase() === 'true' || sampleValue.toLowerCase() === 'false') {
                    propType = 'boolean';
                }
                
                const propName = header.replace(/\s+/g, '');
                ts += `  ${propName}: ${propType};\n`;
            });
            
            ts += `}\n\n`;
            
            // Generate sample data
            ts += `const sampleData: ${currentHeaders[0] || 'MyData'}[] = ${generateJSON(true)};\n`;
            
            return ts;
        }
        
        function generateJSON(noStringify = false) {
            const jsonData = currentData.map(row => {
                const obj = {};
                currentHeaders.forEach(header => {
                    obj[header] = row[header] || null;
                });
                return obj;
            });
            
            return noStringify ? jsonData : JSON.stringify(jsonData, null, 2);
        }
        
        function generateMockAPI() {
            const endpoint = currentHeaders[0] ? `/${currentHeaders[0].toLowerCase().replace(/\s+/g, '-')}` : '/api/data';
            
            let mockAPI = `// Mock API implementation using Express\n`;
            mockAPI += `const express = require('express');\n`;
            mockAPI += `const app = express();\n`;
            mockAPI += `app.use(express.json());\n\n`;
            
            mockAPI += `const data = ${generateJSON(true)};\n\n`;
            
            // GET all
            mockAPI += `app.get('${endpoint}', (req, res) => {\n`;
            mockAPI += `  res.json(data);\n`;
            mockAPI += `});\n\n`;
            
            // GET by ID (if we have an ID column)
            const idColumn = currentHeaders.find(h => h.toLowerCase().includes('id'));
            if (idColumn) {
                mockAPI += `app.get('${endpoint}/:id', (req, res) => {\n`;
                mockAPI += `  const item = data.find(d => d.${idColumn} == req.params.id);\n`;
                mockAPI += `  if (!item) return res.status(404).send('Not found');\n`;
                mockAPI += `  res.json(item);\n`;
                mockAPI += `});\n\n`;
            }
            
            // POST
            mockAPI += `app.post('${endpoint}', (req, res) => {\n`;
            mockAPI += `  const newItem = req.body;\n`;
            if (idColumn) {
                mockAPI += `  newItem.${idColumn} = Math.max(...data.map(d => d.${idColumn})) + 1;\n`;
            }
            mockAPI += `  data.push(newItem);\n`;
            mockAPI += `  res.status(201).json(newItem);\n`;
            mockAPI += `});\n\n`;
            
            // PUT
            if (idColumn) {
                mockAPI += `app.put('${endpoint}/:id', (req, res) => {\n`;
                mockAPI += `  const index = data.findIndex(d => d.${idColumn} == req.params.id);\n`;
                mockAPI += `  if (index === -1) return res.status(404).send('Not found');\n`;
                mockAPI += `  data[index] = { ...data[index], ...req.body };\n`;
                mockAPI += `  res.json(data[index]);\n`;
                mockAPI += `});\n\n`;
            }
            
            // DELETE
            if (idColumn) {
                mockAPI += `app.delete('${endpoint}/:id', (req, res) => {\n`;
                mockAPI += `  const index = data.findIndex(d => d.${idColumn} == req.params.id);\n`;
                mockAPI += `  if (index === -1) return res.status(404).send('Not found');\n`;
                mockAPI += `  data.splice(index, 1);\n`;
                mockAPI += `  res.status(204).send();\n`;
                mockAPI += `});\n\n`;
            }
            
            mockAPI += `const PORT = 3000;\n`;
            mockAPI += `app.listen(PORT, () => {\n`;
            mockAPI += `  console.log(\`Server running on http://localhost:\${PORT}\`);\n`;
            mockAPI += `});\n`;
            
            return mockAPI;
        }
        
        function generateMarkdown() {
            let md = `| ${currentHeaders.join(' | ')} |\n`;
            md += `| ${currentHeaders.map(() => '---').join(' | ')} |\n`;
            
            currentData.forEach(row => {
                md += `| ${currentHeaders.map(header => row[header] || '').join(' | ')} |\n`;
            });
            
            return md;
        }
        
        function downloadCSV() {
            if (!currentData.length) {
                alert('No data to download');
                return;
            }
            
            let csvContent = currentHeaders.join(',') + '\n';
            currentData.forEach(row => {
                csvContent += currentHeaders.map(header => {
                    let cell = row[header] || '';
                    // Escape quotes and wrap in quotes if contains comma or quote
                    if (cell.includes('"') || cell.includes(',')) {
                        cell = `"${cell.replace(/"/g, '""')}"`;
                    }
                    return cell;
                }).join(',') + '\n';
            });
            
            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const url = URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.setAttribute('href', url);
            link.setAttribute('download', 'data.csv');
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }
        
        function copyToClipboard() {
            const output = document.getElementById('output-area').textContent;
            if (!output) {
                alert('No output to copy');
                return;
            }
            
            navigator.clipboard.writeText(output).then(() => {
                alert('Copied to clipboard!');
            }).catch(err => {
                console.error('Failed to copy: ', err);
                alert('Failed to copy to clipboard');
            });
        }
        
        function toggleDarkMode() {
            document.body.classList.toggle('dark-mode');
            localStorage.setItem('darkMode', document.body.classList.contains('dark-mode'));
        }
        
        function analyzeData() {
            if (!currentData.length) {
                alert('No data to analyze');
                return;
            }
            
            const issues = [];
            
            // Check for empty columns
            currentHeaders.forEach(header => {
                const emptyCount = currentData.filter(row => !row[header] || row[header].trim() === '').length;
                if (emptyCount === currentData.length) {
                    issues.push({
                        type: 'Empty column',
                        message: `Column "${header}" is completely empty`,
                        column: header
                    });
                } else if (emptyCount > 0) {
                    issues.push({
                        type: 'Missing values',
                        message: `Column "${header}" has ${emptyCount} empty values (${Math.round(emptyCount / currentData.length * 100)}%)`,
                        column: header
                    });
                }
            });
            
            // Check for duplicate rows
            const rowStrings = currentData.map(row => currentHeaders.map(header => row[header]).join('|'));
            const duplicateRows = {};
            
            rowStrings.forEach((rowStr, index) => {
                if (rowStrings.indexOf(rowStr) !== index) {
                    if (!duplicateRows[rowStr]) {
                        duplicateRows[rowStr] = [index + 1];
                    } else {
                        duplicateRows[rowStr].push(index + 1);
                    }
                }
            });
            
            Object.entries(duplicateRows).forEach(([rowStr, rows]) => {
                if (rows.length > 1) {
                    issues.push({
                        type: 'Duplicate rows',
                        message: `Rows ${rows.join(', ')} are identical`,
                        rows: rows
                    });
                }
            });
            
            // Display issues
            displayIssues(issues);
        }
        
        function displayIssues(issues) {
            const issuesList = document.getElementById('issues-list');
            issuesList.innerHTML = '';
            
            if (issues.length === 0) {
                issuesList.innerHTML = '<p>No issues found in your data! üéâ</p>';
            } else {
                issues.forEach(issue => {
                    const issueElement = document.createElement('div');
                    issueElement.className = 'issue-item';
                    
                    issueElement.innerHTML = `
                        <div><strong>${issue.type}:</strong> ${issue.message}</div>
                        <div class="issue-actions">
                            ${issue.column ? `<button class="btn btn-sm" onclick="fixIssue('empty-column', '${issue.column}')">Fix Column</button>` : ''}
                            ${issue.rows ? `<button class="btn btn-sm" onclick="fixIssue('duplicate-rows', [${issue.rows}])">Remove Duplicates</button>` : ''}
                        </div>
                    `;
                    
                    issuesList.appendChild(issueElement);
                });
            }
            
            document.getElementById('issues-area').style.display = 'block';
        }
        
        function fixIssue(type, data) {
            if (type === 'empty-column') {
                // Remove empty column
                currentHeaders = currentHeaders.filter(header => header !== data);
                currentData.forEach(row => {
                    delete row[data];
                });
                
                // Update display
                displayDataAsText();
                alert(`Column "${data}" removed`);
            } else if (type === 'duplicate-rows') {
                // Remove duplicate rows (keep first occurrence)
                const rowsToRemove = Array.isArray(data) ? data : [data];
                const indexesToRemove = rowsToRemove.map(num => num - 1); // Convert to 0-based index
                
                // Filter out duplicates (keep first occurrence)
                const uniqueData = [];
                const seenRows = new Set();
                
                currentData.forEach((row, index) => {
                    const rowStr = currentHeaders.map(header => row[header]).join('|');
                    if (!seenRows.has(rowStr) || !indexesToRemove.includes(index)) {
                        seenRows.add(rowStr);
                        uniqueData.push(row);
                    }
                });
                
                currentData = uniqueData;
                displayDataAsText();
                alert(`${rowsToRemove.length} duplicate rows removed`);
            }
            
            // Hide issues panel after fix
            hideIssuesPanel();
        }
        
        function hideIssuesPanel() {
            document.getElementById('issues-area').style.display = 'none';
        }
        
        function showEditableTable() {
            const table = document.getElementById('data-table');
            table.innerHTML = '';
            
            // Create header row
            const headerRow = document.createElement('tr');
            currentHeaders.forEach(header => {
                const th = document.createElement('th');
                th.textContent = header;
                headerRow.appendChild(th);
            });
            table.appendChild(headerRow);
            
            // Create data rows
            currentData.forEach((row, rowIndex) => {
                const tr = document.createElement('tr');
                tr.dataset.rowIndex = rowIndex;
                
                currentHeaders.forEach(header => {
                    const td = document.createElement('td');
                    const input = document.createElement('input');
                    input.type = 'text';
                    input.className = 'cell-edit';
                    input.value = row[header] || '';
                    input.dataset.column = header;
                    input.addEventListener('change', function() {
                        currentData[rowIndex][header] = this.value;
                    });
                    td.appendChild(input);
                    tr.appendChild(td);
                });
                
                table.appendChild(tr);
            });
            
            document.getElementById('editable-table').style.display = 'block';
        }
        
        function hideEditableTable() {
            document.getElementById('editable-table').style.display = 'none';
        }
        
        function saveTableEdits() {
            // Data is already updated in the currentData array via the input change events
            displayDataAsText();
            hideEditableTable();
            alert('Changes saved!');
        }
        
        function addNewRow() {
            const newRow = {};
            currentHeaders.forEach(header => {
                newRow[header] = '';
            });
            currentData.push(newRow);
            
            // Refresh the editable table
            showEditableTable();
            
            // Scroll to the new row
            const table = document.getElementById('data-table');
            table.lastChild.scrollIntoView();
        }
        
        function addNewColumn() {
            const columnName = prompt('Enter new column name:');
            if (!columnName) return;
            
            if (currentHeaders.includes(columnName)) {
                alert('Column with this name already exists');
                return;
            }
            
            currentHeaders.push(columnName);
            currentData.forEach(row => {
                row[columnName] = '';
            });
            
            // Refresh the editable table
            showEditableTable();
        }
        
        function deleteSelectedRows() {
            const selectedRows = Array.from(document.querySelectorAll('#data-table tr[data-row-index]'))
                .filter(tr => tr.querySelector('input[type="checkbox"]:checked'))
                .map(tr => parseInt(tr.dataset.rowIndex));
                
            if (selectedRows.length === 0) {
                alert('No rows selected. Check the checkboxes next to rows you want to delete.');
                return;
            }
            
            if (confirm(`Are you sure you want to delete ${selectedRows.length} rows?`)) {
                // Remove rows in reverse order to avoid index issues
                selectedRows.sort((a, b) => b - a).forEach(index => {
                    currentData.splice(index, 1);
                });
                
                // Refresh the editable table
                showEditableTable();
            }
        }
        
        function showChartModal() {
            if (!currentData.length) {
                alert('No data to visualize');
                return;
            }
            
            const modal = document.getElementById('chart-modal');
            const xAxisSelect = document.getElementById('x-axis');
            const yAxisSelect = document.getElementById('y-axis');
            
            // Populate axis selectors
            xAxisSelect.innerHTML = '';
            yAxisSelect.innerHTML = '';
            
            currentHeaders.forEach(header => {
                const option1 = document.createElement('option');
                option1.value = header;
                option1.textContent = header;
                xAxisSelect.appendChild(option1);
                
                const option2 = document.createElement('option');
                option2.value = header;
                option2.textContent = header;
                yAxisSelect.appendChild(option2);
            });
            
            // Set default selections
            xAxisSelect.value = currentHeaders[0];
            yAxisSelect.value = currentHeaders.length > 1 ? currentHeaders[1] : currentHeaders[0];
            
            // Show modal and create initial chart
            modal.style.display = 'block';
            updateChart();
        }
        
        function closeChartModal() {
            document.getElementById('chart-modal').style.display = 'none';
            if (currentChart) {
                currentChart.destroy();
                currentChart = null;
            }
        }
        
        function updateChart() {
            const chartType = document.getElementById('chart-type').value;
            const xAxis = document.getElementById('x-axis').value;
            const yAxis = document.getElementById('y-axis').value;
            
            const ctx = document.getElementById('data-chart').getContext('2d');
            
            // Destroy previous chart if exists
            if (currentChart) {
                currentChart.destroy();
            }
            
            // Prepare data for chart
            const labels = currentData.map(row => row[xAxis]);
            const data = currentData.map(row => {
                const value = row[yAxis];
                return isNaN(value) ? 0 : parseFloat(value);
            });
            
            // Create new chart
            currentChart = new Chart(ctx, {
                type: chartType,
                data: {
                    labels: labels,
                    datasets: [{
                        label: yAxis,
                        data: data,
                        backgroundColor: getRandomColors(data.length),
                        borderColor: '#3b82f6',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: chartType === 'bar' || chartType === 'line' ? {
                        y: {
                            beginAtZero: true
                        }
                    } : {}
                }
            });
        }
        
        function getRandomColors(count) {
            const colors = [];
            for (let i = 0; i < count; i++) {
                colors.push(`hsl(${Math.random() * 360}, 70%, 60%)`);
            }
            return colors;
        }
        
        function downloadChart() {
            if (!currentChart) return;
            
            const link = document.createElement('a');
            link.download = 'chart.png';
            link.href = document.getElementById('data-chart').toDataURL('image/png');
            link.click();
        }
        
        function downloadChartSVG() {
            if (!currentChart) return;
            
            // Chart.js doesn't natively support SVG export, so we'll use a workaround
            const canvas = document.getElementById('data-chart');
            const img = new Image();
            img.src = canvas.toDataURL('image/png');
            
            const svg = `
                <svg xmlns="http://www.w3.org/2000/svg" width="${canvas.width}" height="${canvas.height}">
                    <foreignObject width="100%" height="100%">
                        <div xmlns="http://www.w3.org/1999/xhtml">
                            <img src="${img.src}" width="${canvas.width}" height="${canvas.height}"/>
                        </div>
                    </foreignObject>
                </svg>
            `;
            
            const blob = new Blob([svg], { type: 'image/svg+xml' });
            const url = URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.download = 'chart.svg';
            link.href = url;
            link.click();
        }
        
        function generateShareLink() {
            if (!currentData.length) {
                alert('No data to share');
                return;
            }
            
            // Convert data to compressed JSON
            const dataToShare = {
                headers: currentHeaders,
                data: currentData
            };
            
            const compressed = LZString.compressToEncodedURIComponent(JSON.stringify(dataToShare));
            const url = `${window.location.origin}${window.location.pathname}?data=${compressed}`;
            
            // Copy to clipboard
            navigator.clipboard.writeText(url).then(() => {
                alert('Share link copied to clipboard!\n\nAnyone with this link can access your data.');
            }).catch(err => {
                console.error('Failed to copy share link: ', err);
                alert('Failed to generate share link');
            });
        }
        
        function loadSavedData() {
            // Check URL for shared data
            const urlParams = new URLSearchParams(window.location.search);
            const sharedData = urlParams.get('data');
            
            if (sharedData) {
                try {
                    const decompressed = LZString.decompressFromEncodedURIComponent(sharedData);
                    const parsedData = JSON.parse(decompressed);
                    
                    currentHeaders = parsedData.headers;
                    currentData = parsedData.data;
                    
                    displayDataAsText();
                    document.getElementById('placeholder').style.display = 'none';
                    
                    // Remove the data from URL
                    window.history.replaceState({}, document.title, window.location.pathname);
                } catch (error) {
                    console.error('Error loading shared data:', error);
                }
            }
            
            // Load from localStorage
            const savedData = localStorage.getItem('table2codeData');
            if (savedData) {
                try {
                    const parsedData = JSON.parse(savedData);
                    currentHeaders = parsedData.headers;
                    currentData = parsedData.data;
                    
                    displayDataAsText();
                    document.getElementById('placeholder').style.display = 'none';
                } catch (error) {
                    console.error('Error loading saved data:', error);
                }
            }
            
            // Load conversion history
            const savedHistory = localStorage.getItem('table2codeHistory');
            if (savedHistory) {
                try {
                    conversionHistory = JSON.parse(savedHistory);
                    updateHistoryDisplay();
                } catch (error) {
                    console.error('Error loading history:', error);
                }
            }
        }
        
        function addToHistory(type, content, timestamp) {
            // Add to history array
            conversionHistory.unshift({
                type,
                content,
                timestamp
            });
            
            // Keep only the last 10 items
            if (conversionHistory.length > 10) {
                conversionHistory = conversionHistory.slice(0, 10);
            }
            
            // Save to localStorage
            localStorage.setItem('table2codeHistory', JSON.stringify(conversionHistory));
            
            // Update display
            updateHistoryDisplay();
        }
        
        function updateHistoryDisplay() {
            const historyContainer = document.getElementById('conversion-history');
            const historyItems = document.getElementById('history-items');
            
            if (conversionHistory.length === 0) {
                historyContainer.style.display = 'none';
                return;
            }
            
            historyContainer.style.display = 'block';
            historyItems.innerHTML = '';
            
            conversionHistory.forEach((item, index) => {
                const historyItem = document.createElement('div');
                historyItem.className = 'history-item';
                historyItem.onclick = () => loadFromHistory(index);
                
                historyItem.innerHTML = `
                    <div class="history-header">
                        <span class="history-type">${formatHistoryType(item.type)}</span>
                        <span class="history-date">${item.timestamp}</span>
                    </div>
                    <div style="font-family: 'Fira Code', monospace; font-size: 12px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">
                        ${item.content.substring(0, 100)}${item.content.length > 100 ? '...' : ''}
                    </div>
                `;
                
                historyItems.appendChild(historyItem);
            });
        }
        
        function formatHistoryType(type) {
            const typeMap = {
                'sql': 'SQL',
                'smart-sql': 'Smart SQL',
                'typescript': 'TypeScript',
                'json': 'JSON',
                'mock-api': 'Mock API',
                'markdown': 'Markdown'
            };
            
            return typeMap[type] || type;
        }
        
        function loadFromHistory(index) {
            if (index < 0 || index >= conversionHistory.length) return;
            
            const item = conversionHistory[index];
            document.getElementById('output-area').textContent = item.content;
            
            // Scroll to output
            document.getElementById('output-area').scrollIntoView({
                behavior: 'smooth'
            });
        }
        
        function showAbout() {
            document.getElementById('modal-title').textContent = 'About Table2Code';
            document.getElementById('modal-content').innerHTML = `
                <p>Table2Code is a powerful tool for converting table data into various developer-friendly formats.</p>
                <p><strong>Version:</strong> 1.3.0</p>
                <p><strong>Features:</strong></p>
                <ul>
                    <li>Convert tables to SQL, TypeScript, JSON, Markdown, and more</li>
                    <li>Upload CSV, Excel, Word, and PDF files</li>
                    <li>Edit data directly in the app</li>
                    <li>Generate charts from your data</li>
                    <li>Find and fix data issues</li>
                    <li>Dark mode support</li>
                </ul>
                <p>All processing happens in your browser - your data never leaves your device.</p>
            `;
            document.getElementById('info-modal').style.display = 'flex';
        }
        
        function showPrivacy() {
            document.getElementById('modal-title').textContent = 'Privacy Policy';
            document.getElementById('modal-content').innerHTML = `
                <p><strong>Table2Code Privacy Policy</strong></p>
                <p>Your privacy is important to us. Here's how we handle your data:</p>
                <ul>
                    <li>All data processing happens directly in your browser</li>
                    <li>We do not store, transmit, or analyze your data on any servers</li>
                    <li>If you use the share feature, your data is encoded in the URL but not stored anywhere</li>
                    <li>You can optionally save your data locally in your browser's storage</li>
                    <li>We use Plausible Analytics for basic usage statistics (no personal data collected)</li>
                </ul>
                <p>By using this application, you agree to this privacy policy.</p>
            `;
            document.getElementById('info-modal').style.display = 'flex';
        }
        
        // LZString compression library (for share functionality)
        var LZString = {
            compressToEncodedURIComponent: function(input) {
                if (input == null) return "";
                return this._compress(input, 6, function(a){return this.keyStrUriSafe.charAt(a);});
            },
            decompressFromEncodedURIComponent: function(input) {
                if (input == null) return "";
                if (input == "") return null;
                input = input.replace(/ /g, "+");
                return this._decompress(input.length, 32, function(index) { return this.getBaseValue(this.keyStrUriSafe, input.charAt(index)); });
            },
            keyStrUriSafe: "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+-$",
            _compress: function(uncompressed, bitsPerChar, getCharFromInt) {
                // ... (compression implementation) ...
            },
            _decompress: function(length, resetValue, getNextValue) {
                // ... (decompression implementation) ...
            },
            getBaseValue: function(alphabet, character) {
                // ... (base value implementation) ...
            }
        };
        
        // Initialize LZString methods
        LZString._compress = function(uncompressed, bitsPerChar, getCharFromInt) {
            // ... full compression implementation ...
        };
        
        LZString._decompress = function(length, resetValue, getNextValue) {
            // ... full decompression implementation ...
        };
        
        LZString.getBaseValue = function(alphabet, character) {
            // ... full base value implementation ...
        };
    </script>
</body>
</html>
